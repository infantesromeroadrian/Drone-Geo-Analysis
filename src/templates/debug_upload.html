<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEBUG: Upload Button Analysis</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        
        .debug-section {
            border: 1px solid #00ff00;
            margin: 10px 0;
            padding: 15px;
            background: rgba(0, 255, 0, 0.05);
        }
        
        .hidden {
            display: none !important;
        }
        
        button {
            background: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            font-family: inherit;
        }
        
        button:hover {
            background: #00ff00;
            color: #000;
        }
        
        .result {
            margin: 5px 0;
            padding: 5px;
        }
        
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
    </style>
</head>
<body>
    <h1>üêõ DEBUG: An√°lisis Completo del Bot√≥n Upload</h1>
    
    <div class="debug-section">
        <h2>üìã ELEMENTOS HTML</h2>
        <input type="file" id="cartography-input" accept=".geojson,.json" class="hidden">
        <button id="upload-cartography-btn" type="button">üóÇÔ∏è Test Button</button>
        <div id="html-analysis"></div>
    </div>
    
    <div class="debug-section">
        <h2>üîß TESTS AUTOMATIZADOS</h2>
        <button onclick="runAllTests()">‚ñ∂Ô∏è Ejecutar Todos los Tests</button>
        <button onclick="clearResults()">üóëÔ∏è Limpiar</button>
        <div id="test-results"></div>
    </div>
    
    <div class="debug-section">
        <h2>üåê INFORMACI√ìN DEL NAVEGADOR</h2>
        <div id="browser-info"></div>
    </div>
    
    <div class="debug-section">
        <h2>üìä LOGS EN TIEMPO REAL</h2>
        <div id="live-logs"></div>
    </div>

    <script>
        let testResults = document.getElementById('test-results');
        let liveLogs = document.getElementById('live-logs');
        let testCount = 0;
        
        function addResult(message, type = 'info') {
            testCount++;
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `[${testCount.toString().padStart(2, '0')}] ${message}`;
            testResults.appendChild(div);
            
            // Tambi√©n agregar a logs en vivo
            addLog(message, type);
        }
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `[${timestamp}] ${message}`;
            liveLogs.appendChild(div);
            liveLogs.scrollTop = liveLogs.scrollHeight;
        }
        
        function clearResults() {
            testResults.innerHTML = '';
            liveLogs.innerHTML = '';
            testCount = 0;
        }
        
        // Test 1: Verificar existencia de elementos DOM
        function testDOMElements() {
            addResult('=== TEST 1: ELEMENTOS DOM ===', 'info');
            
            const input = document.getElementById('cartography-input');
            const button = document.getElementById('upload-cartography-btn');
            
            if (input) {
                addResult('‚úÖ Input encontrado', 'success');
                addResult(`   Type: ${input.type}`, 'info');
                addResult(`   Accept: ${input.accept}`, 'info');
                addResult(`   Hidden: ${input.classList.contains('hidden')}`, 'info');
                addResult(`   Display: ${window.getComputedStyle(input).display}`, 'info');
            } else {
                addResult('‚ùå Input NO encontrado', 'error');
                return false;
            }
            
            if (button) {
                addResult('‚úÖ Button encontrado', 'success');
                addResult(`   Type: ${button.type}`, 'info');
                addResult(`   Disabled: ${button.disabled}`, 'info');
                addResult(`   Visible: ${window.getComputedStyle(button).display !== 'none'}`, 'info');
            } else {
                addResult('‚ùå Button NO encontrado', 'error');
                return false;
            }
            
            return true;
        }
        
        // Test 2: Verificar capacidades del navegador
        function testBrowserCapabilities() {
            addResult('=== TEST 2: CAPACIDADES DEL NAVEGADOR ===', 'info');
            
            // File API support
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                addResult('‚úÖ File API soportada', 'success');
            } else {
                addResult('‚ùå File API NO soportada', 'error');
            }
            
            // Input file support
            const testInput = document.createElement('input');
            testInput.type = 'file';
            if (testInput.type === 'file') {
                addResult('‚úÖ Input[type=file] soportado', 'success');
            } else {
                addResult('‚ùå Input[type=file] NO soportado', 'error');
            }
            
            // Click events
            if (typeof Event !== 'undefined') {
                addResult('‚úÖ Event constructor disponible', 'success');
            } else {
                addResult('‚ùå Event constructor NO disponible', 'error');
            }
            
            return true;
        }
        
        // Test 3: Probar click program√°tico
        function testProgrammaticClick() {
            addResult('=== TEST 3: CLICK PROGRAM√ÅTICO ===', 'info');
            
            const input = document.getElementById('cartography-input');
            const button = document.getElementById('upload-cartography-btn');
            
            if (!input || !button) {
                addResult('‚ùå Elementos no disponibles para test', 'error');
                return false;
            }
            
            try {
                // Test click en button
                addResult('üñ±Ô∏è Probando click en button...', 'info');
                button.click();
                addResult('‚úÖ Button.click() ejecutado sin errores', 'success');
                
                // Test click en input
                addResult('üñ±Ô∏è Probando click en input...', 'info');
                input.click();
                addResult('‚úÖ Input.click() ejecutado sin errores', 'success');
                
                return true;
            } catch (error) {
                addResult(`‚ùå Error en click: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Test 4: Probar event listeners
        function testEventListeners() {
            addResult('=== TEST 4: EVENT LISTENERS ===', 'info');
            
            const input = document.getElementById('cartography-input');
            const button = document.getElementById('upload-cartography-btn');
            
            if (!input || !button) {
                addResult('‚ùå Elementos no disponibles para test', 'error');
                return false;
            }
            
            try {
                // Agregar listener temporal al button
                let buttonClicked = false;
                const buttonListener = () => {
                    buttonClicked = true;
                    addResult('üñ±Ô∏è Event listener de button ejecutado', 'success');
                };
                
                button.addEventListener('click', buttonListener);
                addResult('‚úÖ Event listener agregado al button', 'success');
                
                // Agregar listener temporal al input
                let inputChanged = false;
                const inputListener = () => {
                    inputChanged = true;
                    addResult('üìÅ Event listener de input ejecutado', 'success');
                };
                
                input.addEventListener('change', inputListener);
                addResult('‚úÖ Event listener agregado al input', 'success');
                
                // Test program√°tico del button listener
                button.click();
                if (buttonClicked) {
                    addResult('‚úÖ Button listener funciona correctamente', 'success');
                } else {
                    addResult('‚ùå Button listener NO se ejecut√≥', 'error');
                }
                
                // Limpiar listeners
                button.removeEventListener('click', buttonListener);
                input.removeEventListener('change', inputListener);
                addResult('üóëÔ∏è Listeners temporales removidos', 'info');
                
                return true;
            } catch (error) {
                addResult(`‚ùå Error en event listeners: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Test 5: Simular selecci√≥n de archivo
        function testFileSelection() {
            addResult('=== TEST 5: SIMULACI√ìN DE ARCHIVO ===', 'info');
            
            const input = document.getElementById('cartography-input');
            
            if (!input) {
                addResult('‚ùå Input no disponible para test', 'error');
                return false;
            }
            
            try {
                // Crear archivo de prueba
                const testFile = new File(['{"test": "data"}'], 'test.geojson', {
                    type: 'application/geo+json'
                });
                addResult(`üìÅ Archivo de prueba creado: ${testFile.name}`, 'success');
                
                // Simular selecci√≥n usando DataTransfer
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(testFile);
                input.files = dataTransfer.files;
                
                addResult(`üìÑ Archivo asignado: ${input.files.length} archivos`, 'success');
                
                // Disparar evento change
                const changeEvent = new Event('change', { bubbles: true });
                input.dispatchEvent(changeEvent);
                addResult('‚úÖ Evento change disparado', 'success');
                
                return true;
            } catch (error) {
                addResult(`‚ùå Error en simulaci√≥n: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Test 6: Verificar restricciones de seguridad
        function testSecurityRestrictions() {
            addResult('=== TEST 6: RESTRICCIONES DE SEGURIDAD ===', 'info');
            
            // Verificar protocolo
            addResult(`üîí Protocolo: ${window.location.protocol}`, 'info');
            if (window.location.protocol === 'file:') {
                addResult('‚ö†Ô∏è Protocolo file: puede tener restricciones', 'warning');
            }
            
            // Verificar origen
            addResult(`üåê Origen: ${window.location.origin}`, 'info');
            
            // Verificar si estamos en iframe
            if (window !== window.top) {
                addResult('‚ö†Ô∏è Ejecutando en iframe - posibles restricciones', 'warning');
            } else {
                addResult('‚úÖ No en iframe', 'success');
            }
            
            // Verificar user agent
            addResult(`üîç User Agent: ${navigator.userAgent.substring(0, 100)}...`, 'info');
            
            return true;
        }
        
        // Funci√≥n principal para ejecutar todos los tests
        function runAllTests() {
            clearResults();
            addResult('üöÄ INICIANDO DIAGN√ìSTICO COMPLETO...', 'info');
            
            const tests = [
                testDOMElements,
                testBrowserCapabilities,
                testProgrammaticClick,
                testEventListeners,
                testFileSelection,
                testSecurityRestrictions
            ];
            
            let allPassed = true;
            
            tests.forEach((test, index) => {
                try {
                    const result = test();
                    if (!result) allPassed = false;
                } catch (error) {
                    addResult(`‚ùå Test ${index + 1} fall√≥: ${error.message}`, 'error');
                    allPassed = false;
                }
            });
            
            addResult('', 'info');
            if (allPassed) {
                addResult('üéâ TODOS LOS TESTS PASARON - El bot√≥n deber√≠a funcionar', 'success');
            } else {
                addResult('üí• ALGUNOS TESTS FALLARON - Revisar errores arriba', 'error');
            }
        }
        
        // Informaci√≥n del navegador
        function showBrowserInfo() {
            const browserInfo = document.getElementById('browser-info');
            browserInfo.innerHTML = `
                <div class="result info">Navegador: ${navigator.userAgent}</div>
                <div class="result info">Platform: ${navigator.platform}</div>
                <div class="result info">Idioma: ${navigator.language}</div>
                <div class="result info">Cookies: ${navigator.cookieEnabled}</div>
                <div class="result info">En l√≠nea: ${navigator.onLine}</div>
                <div class="result info">URL: ${window.location.href}</div>
            `;
        }
        
        // An√°lisis de HTML
        function analyzeHTML() {
            const htmlAnalysis = document.getElementById('html-analysis');
            const input = document.getElementById('cartography-input');
            const button = document.getElementById('upload-cartography-btn');
            
            htmlAnalysis.innerHTML = `
                <div class="result">Input HTML: ${input ? input.outerHTML : 'NO ENCONTRADO'}</div>
                <div class="result">Button HTML: ${button ? button.outerHTML : 'NO ENCONTRADO'}</div>
            `;
        }
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ P√°gina cargada - Sistema de diagn√≥stico listo', 'success');
            showBrowserInfo();
            analyzeHTML();
            
            // Auto-ejecutar tests despu√©s de 1 segundo
            setTimeout(() => {
                addLog('‚è∞ Auto-ejecutando tests en 3 segundos...', 'warning');
                setTimeout(runAllTests, 3000);
            }, 1000);
        });
    </script>
</body>
</html> 