<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Orden de Funciones JavaScript</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff00;
            padding: 20px;
        }
        
        .test-case {
            border: 1px solid #00ff00;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 255, 0, 0.05);
        }
        
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        .warning { color: #ffaa00; }
    </style>
</head>
<body>
    <h1>üêõ TEST: Problema del Orden de Funciones</h1>
    
    <div class="test-case">
        <h2>‚ùå Caso 1: Funci√≥n llamada ANTES de ser definida (REPRODUCE EL ERROR)</h2>
        <div id="result1">Ejecutando...</div>
    </div>
    
    <div class="test-case">
        <h2>‚úÖ Caso 2: Funci√≥n llamada DESPU√âS de ser definida (CORRECTO)</h2>
        <div id="result2">Ejecutando...</div>
    </div>
    
    <div class="test-case">
        <h2>üîß Caso 3: Usando function declaration (FUNCIONA)</h2>
        <div id="result3">Ejecutando...</div>
    </div>

    <script>
        function log(caseNumber, message, type = 'info') {
            const element = document.getElementById(`result${caseNumber}`);
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            element.innerHTML += `<div class="${className}">${message}</div>`;
        }
        
        // CASO 1: REPRODUCE EL ERROR del archivo original
        document.addEventListener('DOMContentLoaded', function() {
            log(1, 'üöÄ DOM Cargado - Caso 1', 'info');
            
            try {
                // Intentar llamar funci√≥n que se define despu√©s
                log(1, 'üìû Llamando testFunctionNotDefined()...', 'info');
                testFunctionNotDefined(); // ‚ùå Esta funci√≥n se define DESPU√âS
                log(1, '‚úÖ Funci√≥n ejecutada correctamente', 'success');
            } catch (error) {
                log(1, `‚ùå ERROR: ${error.message}`, 'error');
                log(1, 'üí° ESTO ES LO QUE PASA EN drone_control.html', 'warning');
            }
        });
        
        // La funci√≥n se define DESPU√âS del DOMContentLoaded
        function testFunctionNotDefined() {
            log(1, 'üéØ Esta funci√≥n se ejecut√≥ correctamente', 'success');
        }
        
        // CASO 2: SOLUCI√ìN CORRECTA - funci√≥n definida antes
        function testFunctionDefined() {
            log(2, 'üéØ Esta funci√≥n se ejecut√≥ correctamente', 'success');
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            log(2, 'üöÄ DOM Cargado - Caso 2', 'info');
            
            try {
                log(2, 'üìû Llamando testFunctionDefined()...', 'info');
                testFunctionDefined(); // ‚úÖ Esta funci√≥n ya est√° definida
                log(2, '‚úÖ Funci√≥n ejecutada correctamente', 'success');
            } catch (error) {
                log(2, `‚ùå ERROR: ${error.message}`, 'error');
            }
        });
        
        // CASO 3: USANDO HOISTING (function declaration)
        document.addEventListener('DOMContentLoaded', function() {
            log(3, 'üöÄ DOM Cargado - Caso 3', 'info');
            
            try {
                log(3, 'üìû Llamando hoistedFunction()...', 'info');
                hoistedFunction(); // ‚úÖ Las function declarations se "elevan"
                log(3, '‚úÖ Funci√≥n ejecutada correctamente', 'success');
            } catch (error) {
                log(3, `‚ùå ERROR: ${error.message}`, 'error');
            }
        });
        
        // Function declaration - se "eleva" al inicio del scope
        function hoistedFunction() {
            log(3, 'üéØ Function declaration ejecutada (hoisted)', 'success');
        }
        
        // An√°lisis final
        setTimeout(() => {
            document.body.innerHTML += `
                <div class="test-case">
                    <h2>üìã DIAGN√ìSTICO FINAL</h2>
                    <div class="warning">
                        <strong>PROBLEMA EN drone_control.html:</strong><br>
                        ‚Ä¢ La funci√≥n initializeLLMFunctionality() se llama en l√≠nea 2151<br>
                        ‚Ä¢ Pero se DEFINE en l√≠nea 2154 (despu√©s del cierre del DOMContentLoaded)<br>
                        ‚Ä¢ JavaScript no puede ejecutar una funci√≥n que a√∫n no ha sido definida<br><br>
                        
                        <strong>SOLUCI√ìN:</strong><br>
                        ‚Ä¢ Mover la definici√≥n de la funci√≥n ANTES de su llamada<br>
                        ‚Ä¢ O usar function declaration en lugar de function expression<br>
                        ‚Ä¢ O definir la funci√≥n fuera del DOMContentLoaded
                    </div>
                </div>
            `;
        }, 2000);
    </script>
</body>
</html> 